---
title: 'Programming in Python: Lecture 3'
author: "Carolyn Jane Anderson"
date: "9/22/2017"
output: html_document
---

```{r,echo=FALSE}
library(knitr)
opts_chunk$set(engine = 'python',engine.path="/usr/local/bin/python2")
```

Today we're going to work some more with strings. We'll also learn about regular expressions.

#WARMUP EXERCISE

<h3>Regular expressions</h3>

Regular expressions are all about pattern-matching. They are called *regular expressions* because the basic atomics and operations form a *regular language*. However, regular expressions in many languages, including Python, have expanded functionality so that they are no longer regular.

<h4>Regular expression syntax</h5>

<h5>Character classes</h5>

. : any character except newline

\\w : word

\\d : digit

\\s : whitespace

\\t : tab

\\n : newline

<h5>Quantifiers</h5>

\* : 0 or more

\+ : 1 or more

? : 0 or 1

{n} : exactly n

<h5>Anchors</h5>

\^ : start of string

\$ : end of string

<h5>Sets</h5>

[ ] : set

[^ ] : complement of set

\| : or

[ - ] : range

```{python}
import re

s = 'address: 33 Peachtree St.'

m = re.search(r'[0-9]{1}', s) #Find first digit in string
print m.group(0)

n = re.search(r'.*',s) #Find sequence of 0 or more characters
print n.group(0)

print re.search(r'[a-z]',s).group(0) #Find lowercase letter

print re.search(r'[^aA-zZ]+',s).group(0) #Find sequence of non-letters
```

<h4>Regex methods</h4>

There are four methods for regexes.  

You can use match() to check if the beginning of the string matches the regex.

```{python}
import re

s = 'address: 33 Peachtree St.'

print re.match(r'[0-9]{1}', s)
print re.match(r'[a-z]{1}', s).group()
```

You can use search() to try to match the string at any position.

```{python}
import re

s = 'address: 33 Peachtree St.'

print re.search(r'[0-9]{1}', s).group()
print re.search(r'[a-z]{1}', s).group()
```

You can use findall()	to find all substrings where the RE matches. findall() returns all matches as a list.

```{python}
import re

s = 'address: 33 Peachtree St. Apt. 1079'

m = re.findall(r'[0-9]{1}', s) #Find first digit in string
for i in m:
  print i
```

Lastly, finditer(), like findall(), picks out all matching substrings, but it returns them as an interator rather than a list.

<h4>Match object methods</h4>

I've been using group() to get the string matched by search().

There are a few more methods you can use to get different information from the match object.

To return the starting index of the match, use start().

```{python}
import re

s = 'address: 33 Peachtree St.'

print re.search(r'[0-9]{1}', s).start()
print re.search(r'[a-z]{1}', s).start()
```

To get the ending index of the match, use end().

```{python}
import re

s = 'address: 33 Peachtree St.'

print re.search(r'[0-9]{2}', s).end()
print re.search(r'[a-z]{2}', s).end()
```

Last, span() returns a tuple containing the start and end indices of the match.

```{python}
import re

s = 'address: 33 Peachtree St.'

print re.search(r'[0-9]{2}', s).span()
print re.search(r'[a-z]{2}', s).span()
```

<h4>Exercise: finding phone numbers</h4>

Can you write a regex that matches phone numbers?

First we'll assume that each phone number is of the format (413)-555-3091, where the area code is given in parentheses, and hyphens are used to separate the blocks of digits.

Now let's try to be a little more flexible. How many of the valid phone numbers below can you capture, without capturing any of the invalid ones?

You can find the phone numbers in numbers.txt.

```{python}
f = file("/Users/carolyn/Documents/UMass/CogMod/Ling692c/lecture 3/numbers.txt","r")
print f.read()
```

I've written you an evaluation program in phonetest.py. This program takes two command-line arguments: your regular expression, and the name of the file of phone numbers.

For example:

python phonetest.py '^a' numbers.txt

The program prints out a score indicating what fraction of phone numbers you correctly identified. It also prints out the phone numbers that your regex failed to correctly classify (both false negatives and false positives).

I wrote a regex that catches all but two of the numbers: 

5550-0100

1-100-0101

Why are these cases problematic?

What would we have to do to exclude these bad numbers?

For many applications, regular expressions are a useful tool to catch the majority of cases, but it may not make sense to spend the time to consider every last case.

<h4>Capturing groups</h4>

There's one other aspect of regular expressions that I haven't shown you. This is the non-regular feature of most implementations of regular expressions: capturing groups.

Capturing groups is a way of giving regular expressions memory. The parentheses we used to group characters together above actually does a little more work than just making scope explicit.

Parentheses actually define groups, which can be referred to using *backreferences*.

```{python}
import re

fooafoo = re.compile(r'(\w)a\1')
s = 'ana nan bad dad ab banana.'
r = re.findall(fooafoo,s)
print r
```

Here, the \\1 refers to the first group of the expression: whichever character was matched by \\w. The regex above matches sequences where the same character appears before and after an a.




